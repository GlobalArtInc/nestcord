---
id: интеграция с прокси-сервером
title: Интеграция прокси-сервера
sidebar_position: 6
---

NestCord поддерживает настройки прокси для всех подключений к API Discord. Это полезно при развертывании в корпоративных сетях или при использовании VPN.

## Методы настройки прокси

### 1. Простая конфигурация с помощью прокси-пути

```typescript title="src/app.module.ts"
import { NestCordModule } from '@globalart/nestcord';
import { GatewayIntentBits } from 'discord. s';

@Module({
  imports: [
    NestCordModule.forRoot({
      token: process. nv.DISCORD_TOKEN,
      intents: [GatewayIntentBits.Guilds],
      proxyPath: 'http://proxy.company. om:8080',
    }),
  ],
})
экспорт класса AppModule {}
```

### 2. Расширенная конфигурация с помощью прокси объекта

```typescript title="src/app.module.ts"
@Module({
  imports: [
    NestCordModule.forRoot({
      token: process.env. ISCORD_TOKEN,
      intents: [GatewayIntentBits.Guilds],
      proxy: {
        host: 'proxy. оглушение. om',
        порт: 8080, протокол
        : 'http',
        Автор: {
          username: 'user',
          password: 'password',
        },
      },
    }),
  ],
})
экспорт класса AppModule {}
```

## Параметры конфигурации

### proxyPath

- **Тип**: `string`
- **Описание**: Полный URL прокси-сервера
- **Примеры**: 
  - `'http://proxy.company.com:8080'`
  - `'https://user:pass@proxy.company.com:8080'`
  - `'socks5://proxy.company.com:1080'`

### прокси

- **Тип**: `NestCordProxyOptions`
- **Описание**: Объект с подробными настройками прокси

#### NestCordProxyOptions

```typescript
интерфейс NestCordProxyOptions {
  host: строка;                    
  порт: номер;                    
  протокол? 'http' | 'https';     
  автор? {                         
    имя пользователя: строка;
    пароль: строка;
  };
}
```

## Как это работает

1. **Переменные окружения**: при инициализации модуля переменные `HTTP_PROXY` и `HTTPS_PROXY` автоматически устанавливаются
2. **Discord.js клиент**: Все подключения к Discord API будут проходить через указанный прокси
3. **NestCordService**: REST API запросы также будут использовать настройки прокси

## Примеры использования

### Корпоративная сеть

```typescript title="src/app.module.ts"
NestCordModule.forRoot({
  token: process.env.DISCORD_TOKEN,
  intents: [GatewayIntentBits.Guilds],
  proxyPath: 'http://corporate-proxy.company.com:8080',
})
```

### Аутентификация прокси

```typescript title="src/app.module.ts"
NestCordModule.forRoot({
  token: process.env.DISCORD_TOKEN,
  intents: [GatewayIntentBits.Guilds],
  proxy: {
    host: 'secure-proxy. оглушение. om',
    порт: 8080,
    протокол: 'https',
    auth: {
      username: process.env.PROXY_USER,
      password: process.env.PROXY_PASS,
    },
  },
})
```

### SOCKS5 прокси

```typescript title="src/app.module.ts"
NestCordModule.forRoot({
  token: process.env.DISCORD_TOKEN,
  intents: [GatewayIntentBits.Guilds],
  proxyPath: 'socks5://proxy.company.com:1080',
})
```

## Получение информации о прокси

Вы можете получить текущую конфигурацию прокси через NestCordService:

```typescript title="src/my.service.ts"
import { Injectable } from '@nestjs/common';
import { NestCordService } from '@globalart/nestcord';

@Injectable()
export class MyService {
  constructor(private readonly nestcord: NestCordService) {}

  getProxyInfo() {
    const proxyConfig = this. estcord.getProxyConfig();
    console.log('Текущая конфигурация прокси:', proxyConfig);
  }
}
```

## Отладка

При настройке прокси-сервера в логах будут отображаться соответствующие сообщения:

```
[NestCordService] Конфигурация прокси: http://proxy.company.com:8080
[NestCordService] Конфигурация прокси: http://proxy.company.com:8080
```

## Примечания

- Настройки прокси применяются глобально для всего приложения
- Поддерживаются HTTP, HTTPS и SOCKS5 прокси
- Если конфигурация прокси не удается, приложение продолжит работать без прокси
- Настройки прокси влияют на все соединения Discord.js, включая WebSocket и REST API 
