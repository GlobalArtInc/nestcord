---
id: слушатели
slug: слушатели
title: Слушатели
description: Слушатели используются для прослушивания событий, исходящих Discord. Они используются для прослушивания таких событий, как `messageCreate`, `interactionCreate`, `guildMemberAdd` и т.д.
sidebar_position: 3
---

NestCord поддерживает взаимодействие со всеми [discord events](https://discord.js.org/#/docs/main/stable/class/Client#Events) через декоратора `@On`
и `@Once`.\
Хотя наилучшей практикой является использование более специфичных декораторов когда это возможно, это полезно, если вы хотите использовать функции NestCord не
поддержка через пользовательские декораторы, для взаимодействия с сырыми запросами или для прослушивания всех событий с помощью декоратора, например, `interactionCreate`.

```typescript title="src/app.service.ts"
импортировать {Injectable, Logger} из '@nestjs/common';
импортировать {On, On, ContextOf} из '@globalart/nestcord';

@Injectable()
export class AppService {
    private readonly logger = new Logger(AppService.

    @Once('ready')
    public onReady(@Context() [client]: ContextOf<'ready'>) {
        этого. оггер. og(`Bot зарегистрирован как ${client.user.username}`);
    }

    @On('warn')
    public onWarn(@Context() [message]: ContextOf<'warn'>) {
        this. ogger.warn(сообщение);
    }
}
```

:::caution Предупреждение

Если вы используете глобальные фильтры, стражи или перехватчики, они будут срабатывать один раз за событие!\
Это означает, что если вы отвечаете на сообщение в охранниках, вы можете столкнуться с проблемами с дублирующимися ответами или недействительными взаимодействиями.
Взгляните на метаданные `NestCordExecutionContext.getInfo()`, чтобы узнать больше о текущем контексте.

:::

## Контекст

Возможно, вы заметили декоратор `@Context` в последнем сниппете: это используется для включения контекста событий в методе.
Поскольку существует много типов событий, его тип должен быть введен из типа «ContextOf<type: string>».

Вы можете получить доступ к переменным контекста, используя декоратор `@Context()` в вашей функции, который заполнит переменную массивом
.

```typescript title="src/app.service.ts"
@On('messageCreate')
public onMessageCreate(@Context() [message]: ContextOf<'messageCreate'>) {
    console.log(message.content);
}
```

## Пользовательские события

NestCord из коробки поддерживает все события от discord.js. Вы также можете создавать пользовательские события с помощью декораторов `@CustomListenerHandler` и `@CustomListener`.

```typescript title="src/app.service.ts"
import { Injectable } from '@nestjs/common';
import { CustomListener, CustomListenerHandler, BaseHandler, ContextOf } from '@globalart/nestcord';
import { User, UserFlagsBitField } from 'discord. s';

export type CustomUserUpdateEvents = {
	userAvatarUpdate: [user: User, oldAvatar: string, newAvatar: string];
};

тип экспорта ContextOfCustomUserUpdate<K extends keyof E, E = CustomUserUpdateEvents> = E[K];


@Injectable()
@CustomListener('userUpdate')
export class UserUpdateHandler extends BaseHandler<CustomUserUpdateEvents> {
	@CustomListenerHandler()
	public handleUserAvatarUpdate([oldUser, newUser]: ContextOf<'userUpdate'>) {
		if (oldUser. artial) return;

		if (oldUser.displayAvatarURL() !== newUser.displayAvatarURL()) {
			это.emit(
				'userAvatarUpdate',
				newUser,
				oldUser. isplayAvatarURL(),
				newUser.displayAvatarURL()
			);
		}
	}
}
```

А потом вы можете послушать пользовательское событие с помощью декоратора `@On`.

```typescript title="src/app.service.ts"
@On('userAvatarUpdate')
public onUserAvatarUpdate(
    @Context() [user, oldAvatar, newAvatar]: ContextOfCustomUserUpdate<'userAvatarUpdate'>
) {
    консоль. og(
        `Пользователь ${user.tag} изменил свой аватар с ${oldAvatar} на ${newAvatar}`
    );
}
```

Также поддерживает пользовательские события.

### События канала

| Название события                      | Описание                                                                    |
| ------------------------------------- | --------------------------------------------------------------------------- |
| `guildChannelPermissionsUpdate`       | Возникает всякий раз, когда перезаписывается разрешение канала для гильдии. |

### События в Гильдии

| Название события                | Описание                                                                    |
| ------------------------------- | --------------------------------------------------------------------------- |
| `guildBoostLevelUp`             | Возникает всякий раз, когда повышается уровень усиления гильдии.            |
| `guildBoostLevelDown`           | Возникает всякий раз, когда снижается уровень усиления гильдии.             |
| `guildBannerAdd`                | Возникает всякий раз, когда добавляется баннер гильдии.                     |
| `guildAfkChannelAdd`            | Возникает всякий раз, когда добавляется AFK канал гильдии.                  |
| `guildVanityURLAdd`             | Возникает при добавлении персонального URL-адреса гильдии.                  |
| `guildVanityURLUpdate`          | Возникает всякий раз, когда обновляется персональный URL гильдии.           |
| `guildVanityURLRemove`          | Возникает всякий раз, когда удаляется персональный URL гильдии.             |
| `guildFeaturesUpdate`           | Возникает при обновлении функций гильдии.                                   |
| `guildAcronymUpdate`            | Возникает при обновлении аббревиатуры гильдии.                              |
| `guildOwnerUpdate`              | Возникает при обновлении владельца гильдии.                                 |
| `guildPartnerAdd`               | Возникает всякий раз, когда гильдия является партнером дискорда             |
| `guildPartnerRemove`            | Возникает всякий раз, когда гильдия больше не является партнером в развязке |
| `guildVerificationAdd`          | Возникает всякий раз, когда добавляется уровень проверки гильдии.           |
| `guildVerificationRemove`       | Возникает всякий раз, когда удаляется уровень проверки гильдии.             |

#### События журнала аудита гильдии

| Название события                        | Описание                                                           |
| --------------------------------------- | ------------------------------------------------------------------ |
| `guildAuditLogEntryAdd`                 | Возникает при добавлении записи в журнал аудита.                   |
| `guildAuditLogEntryUpdate`              | Возникает каждый раз, когда запись обновляется в журнале аудита.   |
| `guildAuditLogEntryDelete`              | Возникает всякий раз, когда запись удаляется из журнала аудита.    |
| `guildAuditLogEntryWebhookCreate`       | Возникает всякий раз, когда веб-хук создается в журнале аудита.    |
| `guildAuditLogEntryWebhookUpdate`       | Возникает всякий раз, когда веб-хук обновляется в журнале аудита.  |
| `guildAuditLogEntryWebhookDelete`       | Возникает всякий раз, когда веб-хук удаляется в журнале аудита.    |

#### События членов гильдии

| Название события                  | Описание                                                         |
| --------------------------------- | ---------------------------------------------------------------- |
| `guildMemberBoost`                | Возникает всякий раз, когда активирован бонус игрока.            |
| `guildMemberUnboost`              | Возникает всякий раз, когда активирован бонус игрока.            |
| `guildMemberRoleAdd`              | Возникает всякий раз, когда роль добавляется члену.              |
| `guildMemberRoleRemove`           | Возникает всякий раз, когда роль удаляется из участника.         |
| `guildMemberNicknameUpdate`       | Возникает при обновлении псевдонима пользователя.                |
| `guildMemberEntered`              | Возникает всякий раз, когда участник вступает в гильдию.         |
| `guildMemberAvatarAdd`            | Возникает при добавлении аватара пользователя.                   |
| `guildMemberAvatarRemove`         | Возникает при удалении аватара пользователя.                     |
| `guildMemberAvatarUpdate`         | Возникает при обновлении аватара пользователя.                   |

#### События обновления роли

| Название события              | Описание                                                       |
| ----------------------------- | -------------------------------------------------------------- |
| `rolePositionUpdate`          | Возникает при обновлении позиции роли.                         |
| `rolePermissionsUpdate`       | Возникает при обновлении прав доступа роли.                    |
| `roleIconAdd`                 | Возникает всякий раз, когда добавляется иконка роли.           |
| `roleIconRemove`              | Возникает всякий раз, когда удаляется иконка роли.             |
| `roleIconUpdate`              | Возникает всякий раз, когда обновляется иконка роли.           |

#### События обновления темы

| Название события                        | Описание                                                                 |
| --------------------------------------- | ------------------------------------------------------------------------ |
| `threadStateUpdate`                     | Возникает всякий раз, когда состояние темы обновляется.                  |
| `threadNameUpdate`                      | Возникает при обновлении имени потока.                                   |
| `threadLockStateUpdate`                 | Возникает при обновлении состояния блокировки потока.                    |
| `threadRateLimitPerUserUpdate`          | Возникает всякий раз, когда обновляется лимит потоков на пользователя.   |
| `threadAutoArchiveDurationUpdate`       | Возникает всякий раз, когда обновляется автоархив потока.                |

### События сообщения

| Название события             | Описание                                           |
| ---------------------------- | -------------------------------------------------- |
| `messagePinned`              | Возникает всякий раз, когда сообщение закреплено.  |
| `messageContentEdited`       | Возникает при обновлении сообщения.                |

### События присутствия

| Название события           | Описание                                                          |
| -------------------------- | ----------------------------------------------------------------- |
| `guildMemberOffline`       | Возникает всякий раз, когда участник выходит в автономном режиме. |
| `guildMemberOnline`        | Возникает всякий раз, когда участник идёт онлайн.                 |

### События пользователя

| Название события                           | Описание                                              |
| ------------------------------------------ | ----------------------------------------------------- |
| `userAvatarUpdate`                         | Возникает при обновлении аватара пользователя.        |
| `userUsernameUpdate`                       | Возникает при обновлении имени пользователя.          |
| "Пользовательская дискриминацияОбновления" | Возникает при обновлении дискриминатора пользователя. |
| `userFlagsUpdate`                          | Возникает при обновлении флагов пользователя.         |

### Голосовые события

| Название события              | Описание                                                                                   |
| ----------------------------- | ------------------------------------------------------------------------------------------ |
| `voiceChannelJoin`            | Возникает каждый раз, когда участник присоединяется к голосовому каналу.                   |
| `voiceChannelLeave`           | Возникает каждый раз, когда участник покидает голосовой канал.                             |
| `voiceChannelSwitch`          | Возникает при переключении голосового канала.                                              |
| `voiceChannelMutestate`       | Возникает всякий раз, когда участник заглушен или заглушен в голосовом канале.             |
| `voiceChannelUnmute`          | Возникает всякий раз, когда участник разговаривает в голосовом канале.                     |
| `voiceChannelDeaf`            | Возникает всякий раз, когда участник деформируется в голосовом канале.                     |
| `voiceChannelUndeaf`          | Возникает всякий раз, когда участник не пропускается в голосовом канале.                   |
| `voiceStreamingStart`         | Возникает всякий раз, когда участник начинает стримить.                                    |
| `voiceStreamingStop`          | Возникает всякий раз, когда участник останавливает трансляцию.                             |
